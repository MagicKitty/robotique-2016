package Camera;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ComponentAdapter;
import java.awt.event.ComponentEvent;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;
import java.net.MalformedURLException;

import javax.swing.JFrame;
import javax.swing.JLayeredPane;

import com.github.sarxos.webcam.Webcam;
import com.github.sarxos.webcam.WebcamPanel;
import com.github.sarxos.webcam.WebcamResolution;
import com.github.sarxos.webcam.ds.ipcam.IpCamDeviceRegistry;
import com.github.sarxos.webcam.ds.ipcam.IpCamDriver;
import com.github.sarxos.webcam.ds.ipcam.IpCamMode;

/**
 *
 * @author Bartosz Firyn (SarXos)
 */
public class Cam {

	static JFrame f = new JFrame("IHM - Robafis - 2016");
	static Dimension die ,die2;

	static {
		Webcam.setDriver(new IpCamDriver());
	}

	public static void main(String[] args) throws MalformedURLException {

		System.out.println("Started IHM");






		IpCamDeviceRegistry.register("Smartphone", "http://192.168.43.1:8080/video", IpCamMode.PUSH);

		Webcam webcam = (Webcam) Webcam.getWebcams().get(0);
		webcam.setViewSize(WebcamResolution.VGA.getSize());
		WebcamPanel video = new WebcamPanel(webcam);
		video.setFPSDisplayed(true);
		video.setDisplayDebugInfo(false);
		video.setImageSizeDisplayed(true);

		int widthBounds = (int)webcam.getViewSize().getWidth();
		int heightBounds = (int)webcam.getViewSize().getHeight();
		double proportion = widthBounds/heightBounds;
		Dimension dimensionWebcam = new Dimension(widthBounds,heightBounds);
		f.setPreferredSize(new Dimension(dimensionWebcam));
		f.setResizable(true);

		die = f.getSize();
		f.addComponentListener(new ComponentAdapter(){
			public void componentResized(ComponentEvent e) {
				double proportion = f.getWidth()/f.getHeight();
				int width = f.getWidth();
				int height = f.getHeight();
				if(e.getSource() instanceof JFrame)	{
					die2 = f.getSize();
					if(die2.equals(die)) {
						die = die2;
					} else {
						System.out.println("RESIZED");
						while(proportion < (1.33)) {
							width++;
							f.setSize(width,f.getHeight());
							proportion = f.getWidth()/f.getHeight();
						}
//						while(proportion > (1.8)) {
//							height++;
//							f.setSize(f.getWidth(),height);
//							proportion = f.getWidth()/f.getHeight();
//						}
					}
				}
			}

		});

		JLayeredPane layeredPane = new JLayeredPane();
		f.add(layeredPane, BorderLayout.CENTER);

		video.setBounds(0, 0, widthBounds, heightBounds); // augmenter la taille de la video
		layeredPane.add(video, new Integer(1));

		f.pack();
		f.setLocationRelativeTo(null);
		f.setVisible(true);
		f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);






		System.out.println("Ended IHM");
	}
}
